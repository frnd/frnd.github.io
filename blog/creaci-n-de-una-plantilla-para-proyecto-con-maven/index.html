<!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>frnd</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/images/favicon.ico">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="alternate" type="application/rss+xml" title="frnd" href="/rss.xml">
  </head>
  <body>
    <div class="site-wrap">
      <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="/" class="site-title">frnd</a>
      <nav class="site-nav right">
        <a href="/blog">Blog</a><a href="/about">About</a></nav>
      <div class="clearfix"></div>
      
    </div>
  </div>
</header>


      <div class="post p2 p-responsive wrap" role="main">
        <div class="measure">
          
<div class="post">
  <header class="post-header mb2">
    <h1>Creación de una plantilla para proyecto con Maven.</h1>
    <span class="post-meta">Apr 9, 2011</span><br>
    <span class="post-meta small">
    <a href="/tags/archetype" title="archetype">archetype</a>, <a href="/tags/java" title="java">java</a>, <a href="/tags/maven" title="maven">maven</a>, <a href="/tags/platilla" title="platilla">platilla</a>, <a href="/tags/proyecto" title="proyecto">proyecto</a>
    </span>
  </header>
  <article class="post-content py2">
  <p>Maven es una herramienta muy útil para la gestión de proyectos. Facilita la gestión de dependencias del proyecto, pruebas unitarias, integración continua. Está basado en un sistema de plugins que ofrece la posibilidad de extender Maven para realizar cualquier tipo de tarea. En este artículo vamos a ver como se puede usar esta herramienta para generar una plantilla para acelerar el desarrollo de nuevos proyectos.</p>
<p>Como ya hemos dicho, Maven es una herramienta para compilar y gestionar proyectos.  Es muy usada en proyectos Java, aunque es genérica y podría ser usada para cualquier lenguaje. Está basada en que el proyecto tiene una estructura de directorios específica que veremos posteriormente, aunque es totalmente configurable.</p>
<p>##Creación de una plantilla vacía.</p>
<p>Una plantilla para Maven tiene la siguiente estructura:</p>
<pre><code>archetype
|-- pom.xml
`-- src
    `-- main
        `-- resources
            |-- META-INF
            |   `-- maven
            |       `--archetype.xml ó archetype-metadata.xml
            `-- archetype-resources
                |-- pom.xml
                `-- src
                    |-- main
                    |   `-- java
                    `-- test
                        `-- java
</code></pre><p>Como puedes ver, sigue la estructura de cualquier proyecto Maven. Hay varios ficheros que hay que tener en cuenta:</p>
<ul>
<li>pom.xml en el directorio raíz se encuentra el fichero POM con la información para gestionar el proyecto para generar la plantilla.</li>
<li>pom.xml: Será el POM del proyecto que se genere usando la plantilla que estamos creando. Podemos decir que el contenido de la carpeta archetype-resources será el contenido del proyecto que generemos con esta platilla.</li>
<li>archetype.xml ó archetype-metadata.xml: Describe los ficheros que contendrá el proyecto que se genere con esta plantilla. El primero (archetype.xml) es para la versión 1 del plugin, mientras que el segundo (archetype-metadata.xml) se usa en la versión 2 o superiores.</li>
</ul>
<p>En el directorio archetype-resources estarán los ficheros que contendrá el proyecto que generemos con esta plantilla.</p>
<p>En el directorio archetype-resources estarán los ficheros que contendrá el proyecto que generemos con esta plantilla.</p>
<p>Puedes crear esa estructura a mano, pero es más sencillo usar el <a href="http://maven.apache.org/plugins/maven-archetype-plugin/usage.html" title="maven-archetype-plugin">plugin Archetype</a> que te permite crear esa estructura sin esfuerzo. Para esto usaremos el siguiente comando:</p>
<pre><code>mvn archetype:generate
</code></pre><p>##Creación de una plantilla basándose en un proyecto existente.</p>
<p>Si ya tienes un proyecto sobre el que quieras crear un modelo para poder generar proyectos similares puedes ejecutar el siguiente comando:</p>
<pre><code>mvn archetype:create-from-project
</code></pre><p>Una vez que Maven haya finalizado su ejecución, en la carpeta target/generated-source tendrás la plantilla para tu proyecto con los ficheros pom.xml, archetype.xml y archetype-metadata.xml generados de forma automática.</p>
<p>Es posible que necesites realizar alguna modificación en los ficheros para adaptar mejor la plantilla a tus necesidades. Por ejemplo:</p>
<ul>
<li>Organizar el código en un paquete</li>
<li>Definir variables en el contenido del fichero para adaptar ciertos nombres a tus necesidades.</li>
<li>Personalizar los nombres de ficheros según unas variables.</li>
</ul>
<p>##Organizar los ficheros en paquetes</p>
<p>Dentro del fichero archetype-metadata.xml encontraremos una serie de descriptores de los directorios en los que se compone nuestro proyecto. Un ejemplo sería:</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">fileSet</span> <span class="hljs-attribute">filtered</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">packaged</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">encoding</span>=<span class="hljs-value">"UTF-8"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">directory</span>&gt;</span>src/main/java<span class="hljs-tag">&lt;/<span class="hljs-title">directory</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">includes</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">include</span>&gt;</span>**/*.java<span class="hljs-tag">&lt;/<span class="hljs-title">include</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">includes</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">fileSet</span>&gt;</span></code></pre>
Como vemos es bastante descriptivo, pero vamos a explicar la parte que nos interesa.  En el elemento fileSet vemos el atributo packaged="true", mediante este atributo indicamos a maven que al prosesar el contenido de ese directorio use una estructura de paquetes. Si por ejemplo, el contenido de ese directorio es

    src/main/java
              |-- common
              |    `-- Objeto.java
              |-- servicio
                    `-- Objeto.java

en el proyecto resultado estará dentro de una estructura de paquetes indicado mediante la variable ${package}. Si por ejemplo el contenido de esta variable es es.excelsit.miProyecto el resultado sería:

    src/main/java
        es
        `--excelsit
            `-- miProyecto
                  |-- common
                  |   `-- Objeto1.java
                  |-- servicio
                      `-- Objeto2.java

El fichero para la clase Objeto1 y Objeto2 deberá contener la instrucción package es.excelsit.miProyecto;. Para ello usaremos la siguiente sintaxis para la definición del paquete:

    package ${package};

##Uso de variables en la plantilla.

Si abrimos alguno de los ficheros de nuestra plantilla veremos que todos comienzan con algo asi:

    #set ( $symbol_pound = '#' )
    #set ( $symbol_dollar = '$' )
    #set ( $symbol_escape = '\' )

Como vemos por su sintaxis, el plugin usa de forma interna Velocity para la generación y adaptación de los ficheros de nuestra platilla de proyecto. Esto nos permite mucha libertad a la hora de crear el contenido del fichero. Hay que tener en cuenta que como  los símbolos almoadilla (#), dolar ($) y barra invertida (\) son caracteres especiales, si los queremos usar deberemos hacerlo mediante sus variables $symbol_pound, $symbol_dollar y $symbol_escape correspondientes.

###Añadir propiedades propias.

Podremos crear propiedades propias de la siguiente forma:

    #set ( $miPropiedad = 'valor' )

En este punto tendremos toda la libertad que ofrece Velocity para concatenar cadenas, obtener la fecha del sistema, etc. Estas propiedades que creemos las podemos usar dentro del contenido del fichero mediante:

    $miPropiedad

También tenemos la posibilidad de renombrar ficheros según nuestras necesidades durante el proceso de generación de nuestro proyecto a partir de la plantilla. Para poder usar variables en el nombre del fichero usaremos dos careateres guión bajo (_) rodeando el nombre de la varible para indicar que se debe sustituir por su vlaor. Por ejemplo:

<pre><code class="hljs">__miPropiedad__App<span class="hljs-class">.java</span>
__artifactId__-context<span class="hljs-class">.xml</span>
__groupId__App.java</code></pre>

<p>###Personalizar el nombre de ficheros con variables.</p>
<p>De forma predeterminada tenemos usa serie da variables ya predefinidas quepodemos usar para renombrar ficheros de nuestra plantilla, pero nos puede interesar crear variables en el momento de generar el proyecto para renombrar ficheros. Para poder hacer esto podemos valernos de que el primer fichero que se procesa es el pom.xml y crear en el las variebles con el valor que necesitemos. Posteriormente podremos hacer referencia a esas variables definidas en el nombre del fichero. Por ejemplo podemos definir el fichero pom.xml de la siguiente forma:</p>
<pre><code class="hljs"><span class="hljs-comment">#set ( $customProperty = 'Excelsit' )</span>
<span class="hljs-comment">#set ( $theArtifactId = $artifactId )</span>
<span class="hljs-comment">#set ( $thegroupId = $groupId )</span>
<span class="hljs-comment">#set ( $theVersion = $version )</span>
<span class="hljs-variable">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;</span>
<span class="hljs-variable">&lt;modelVersion&gt;</span>4.0.0<span class="hljs-variable">&lt;/modelVersion&gt;</span>
<span class="hljs-variable">&lt;groupId&gt;</span>$thegroupId<span class="hljs-variable">&lt;/groupId&gt;</span>
<span class="hljs-variable">&lt;artifactId&gt;</span>$theArtifactId<span class="hljs-variable">&lt;/artifactId&gt;</span>
<span class="hljs-variable">&lt;version&gt;</span>$theVersion<span class="hljs-variable">&lt;/version&gt;</span>
<span class="hljs-variable">&lt;dependencies&gt;</span>
<span class="hljs-variable">&lt;dependency&gt;</span>
<span class="hljs-variable">&lt;groupId&gt;</span>junit<span class="hljs-variable">&lt;/groupId&gt;</span>
<span class="hljs-variable">&lt;artifactId&gt;</span>junit<span class="hljs-variable">&lt;/artifactId&gt;</span>
<span class="hljs-variable">&lt;version&gt;</span>3.8.1<span class="hljs-variable">&lt;/version&gt;</span>
<span class="hljs-variable">&lt;scope&gt;</span>test<span class="hljs-variable">&lt;/scope&gt;</span>
<span class="hljs-variable">&lt;/dependency&gt;</span>
<span class="hljs-variable">&lt;/dependencies&gt;</span>
<span class="hljs-variable">&lt;/project&gt;</span></code></pre>

<p>En la línea 1 hemos definido una propiedad a la que le hemos dado cierto valor. Pero recuerda que internamente funciona con Velocity, por lo que podremos generar ese valor de cualquier forma. Podremos usar esa propiedad para renombrar ficheros según la forma que hemos visto anteriormente __customProperty__App.java</p>
<p>##Usar la plantilla.</p>
<p>Para usar la plantilla lo más sencillo es realizar una instalación local. Usaremos el siguiente comando dentro de la carpeta de nuestro proyecto:</p>
<pre><code>$mvn install
</code></pre><p>Una vez instalado podremos usarlo meniante archetype:generate. Por defecto el plugin buscará en catalogo central de Maven. Para modificar este comportamiento usaremos el parámetro archetypeCatalog=local:</p>
<pre><code>mvn archetype:generate -DarchetypeCatalog=local
</code></pre><p>Si no aparece nuestra plantilla quizás deberamos actualizar el catalogo mediante el comando:</p>
<pre><code>mvn archetype:crawl
</code></pre><p>##Código de ejemplo</p>
<p>Descarga el ejemplo de plantilla: [example-archetype] (/upload/frnd-example-archetype.zip).</p>

  </article>
  
    <div class="post-content">
      <div id="disqus_thread"></div>
    </div>
  
</div>

        </div>
      </div>
    </div>
    <footer class="footer">
  <div class="p2 wrap">
    <div class="measure mt1 center">
      <small>
        built with <a href="http://www.metalsmith.io/">metalsmith</a> & theme from <a href="https://github.com/johnotander/pixyll">pixyll</a>
      </small>
    </div>
  </div>
</footer>

    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.easing.js"></script>
    <script src="/js/scripts.js"></script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', '123457', 'auto');
  ga('send', 'pageview');
</script>
    
<script type="text/javascript">
  // disqus
  var disqus_shortname = 'frnd.github.io';
  var disqus_title = 'Creación de una plantilla para proyecto con Maven.';
  var disqus_url = 'http://frnd.github.io/blog/creaci-n-de-una-plantilla-para-proyecto-con-maven/';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  // Twitter
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script>

  </body>
</html>
