 <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Uso del Table Control en tu Dynpro.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/images/favicon.ico">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="alternate" type="application/rss+xml" title="frnd" href="/rss.xml">
    
    <meta name="author" content="Fernando González">
    
    
    <meta name="description" content="El objetivo es conocer los conceptos más importantes a la hora de trabajar con un table control y crear uno mediante el
asistente. También se estudiará el…">
    
    
    <meta name="keywords" content="abap, asistente, dynpro, module, PAI, PBO, SAP, subrutina, table control">
    
  </head>
  <body>
    <div class="site-wrap">
      <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="/" class="site-title">frnd</a>
      <nav class="site-nav right">
        <a href="/blog">Blog</a><a href="/about">About</a></nav>
      <div class="clearfix"></div>
      
    </div>
  </div>
</header>

      <div class="post p2 p-responsive wrap" role="main">
        <div class="measure">
          
<div class="post">
  <header class="post-header mb2">
    <h1>Uso del Table Control en tu Dynpro.</h1>
    <span class="post-meta">Aug 11, 2010</span><br>
    <span class="post-meta small">
    <a href="/tags/abap" title="abap">abap</a>, <a href="/tags/asistente" title="asistente">asistente</a>, <a href="/tags/dynpro" title="dynpro">dynpro</a>, <a href="/tags/module" title="module">module</a>, <a href="/tags/PAI" title="PAI">PAI</a>, <a href="/tags/PBO" title="PBO">PBO</a>, <a href="/tags/SAP" title="SAP">SAP</a>, <a href="/tags/subrutina" title="subrutina">subrutina</a>, <a href="/tags/table-control" title="table control">table control</a>
    </span>
  </header>
  <article class="post-content py2">
  <p>El objetivo es conocer los conceptos más importantes a la hora de trabajar con un table control y crear uno mediante el
asistente. También se estudiará el código que generado para las tareas más usuales y se darán alguno ejemplos.</p>
<p>Para usar correctamente este control hay que tener un punto clave muy claro. En cada ciclo PAI – PBO el Table Control
mostrara el contenido de la tabla interna al que se haya asociado. Por lo tanto, si se hace una modificación en los
datos que se están mostrando en la Dynpro estos hay que salvarlos en la tabla interna en el PAI para que al completarse
el ciclo se muestren las modificaciones.</p>
<p>Otra de las necesidades más comunes al usar un Table Control es el hecho de activar/desactivar alguna de sus celdas
según una condición en alguno de los campos de la fila en la que se encuentra o según el contenido de ese campo. Esta
tarea se realiza en el PBO ya que es algo que se debe realizar justo antes de mostrar la tabla.</p>
<p>En el siguiente esquema vemos cada una de las acciones que se pueden realizar para manejar un Table Control y donde se
deben realizar.</p>
<p><img src="/images/2010/08/1.png" alt="Alt Esquema general" title="Esquema general"></p>
<h2 id="pasos-previos-para-crear-un-table-control-">Pasos previos para crear un Table Control.</h2>
<p>Crear un Table Control es un proceso muy sencillo usando el Wizard que tenemos en el entorno de desarrollo, pero antes
de ejecutar este Wizard hay que crear una serie de elementos en nuestro código:</p>
<p>Crear un tipo estructura que contendrá los campos que se mostrarán en la tabla junto con un campo oculto que se usará
de forma interna para marcar las filas seleccionadas. Para nuestro ejemplo quedará de la siguiente forma, donde el campo mark será el campo interno para marcar las filas seleccionadas:</p>
<pre><code>TYPES: BEGIN OF ty_s_tablecontrol,
idemp TYPE ZEMPLEADOS-IDEMP,
fecha TYPE ZDATGEN-FECHA,
nombr TYPE ZEMPLEADOS-NOMBR,
apel1 TYPE ZEMPLEADOS-APEL1,
apel2 TYPE ZEMPLEADOS-APEL2,
mark TYPE C,
DELETE TYPE C,
END OF ty_s_tablecontrol.
</code></pre><p>Definir un tipo tabla según la estructura anteriormente creada.</p>
<pre><code>TYPES ty_t_tablecontrol TYPE STANDARD TABLE OF ty_s_tablecontrol.
</code></pre><p>Definir una variable para la tabla interna y su área de trabajo.</p>
<pre><code>DATA wa_tablecontrol TYPE ty_s_tablecontrol.
DATA it_tablecontrol TYPE ty_t_tablecontrol.
</code></pre><h2 id="uso-del-wizard">Uso del Wizard</h2>
<p>En este momento ya tenemos todos los elementos básicos para usar el Wizard y mostrar nuestro Table Control.</p>
<p><strong>Importante: Antes de usar el asistente hay que activar el programa por completo.</strong></p>
<p>Crearemos una Dynpro de tipo normal y cuya pantalla siguiente sea esa misma Dynpro. Para ejecutar dicho asistente
acudimos al Layout de nuestra Dynpro y pulsamos el botón Table Control mediante Wizard. Podemos realizar lo mismo sin el Asistente pero será trabajar de más y con mayores posibilidades de equivocarnos.</p>
<p>Para ejecutar el asistente tenemos usaremos el icono de la barra lateral del Layout.</p>
<p><img src="/images/2010/08/2.png" alt="Alt Insertar un table control con el asistente" title="Insertar un table control con el asistente"></p>
<p>El primer paso del asistente pulsaremos el botón Continuar. De momento es sencillo.</p>
<p><img src="/images/2010/08/3.png" alt="Alt Asistente - Inicio" title="Asistente - Inicio"></p>
<p>En el segundo paso es darle un nombre a nuestro Table Control. Es importante elegir un nombre no muy largo por que el
asistente creará subrutinas según ese nombre y si es muy largo se nos irá del número de caracteres máximo.</p>
<p><img src="/images/2010/08/4.png" alt="Alt Asistente - Nombre del Table Control" title="Asistente - Nombre del Table Control"></p>
<p>En el tercer paso nos pide si el Table Control va a manejar directamente una tabla del diccionario de datos o una tabla
interna. Si seleccionamos la primera opción, con este Table Control vamos a modificar directamente el contenido de una
tabla de la base de datos. No es necesario decir que esto puede ser un poco peligroso.</p>
<p><img src="/images/2010/08/5.png" alt="Alt Asistente - Nombre de la tabla" title="Asistente - Nombre de la tabla"></p>
<p>Si seleccionamos la segunda opción deberemos indicar la tabla interna que va a gestionar el Table Control  y el área de
trabajo que usaremos. Estos datos son las variables que creamos anteriormente.</p>
<p>En el cuarto paso seleccionaremos las filas que queremos mostrar en la tabla. Dejaremos sin seleccionar el campo que
hemos creado para guardar las filas seleccionadas.</p>
<p><img src="/images/2010/08/6.png" alt="Alt Asistente - Definición de columnas" title="Asistente - Definición de columnas"></p>
<p>En el siguiente paso seleccionaremos si la tabla será sólo de salida, es decir, no se podrán hacer modificaciones sobre el contenido de la tabla, de Entrada, que entonces permitirá realizar modificaciones sobre el contenido y crear nuevas líneas. Hay que tener en cuenta que esta configuración se podrá modificar posteriormente accediendo a la configuración desde el Layout o mediante código activando o desactivando la entrada de datos en el campo o la columna. Esto ya lo veremos posteriormente. En este ejemplo crearemos el Table Control de tipo Entrada y añadiremos la columna reservada en
los pasos anteriores para el Campo columna de selección.  Habilitaremos la selección múltiple si queremos que esté
disponible al usuario.</p>
<p><img src="/images/2010/08/7.png" alt="Alt Asistente - Atributos del Table Control" title="Asistente - Atributos del Table Control"></p>
<p>En el siguiente paso nos solicita que botones estándar tiene que crear para nuestro Table Control donde seleccionaremos
todas las casillas.</p>
<p><img src="/images/2010/08/8.png" alt="Alt Asistente - Selección de funciones" title="Asistente - Selección de funciones"></p>
<p>En este penúltimo paso indicaremos el nombre de los includes que usamos en nuestro código y donde el asistenta
introducirá las partes de código necesarias. Si seguimos la nomenclatura estándar tendremos los siguientes includes
para cada caso:</p>
<ul>
<li>*TOP – Definiciones de datos.</li>
<li>*O01 – PBO.</li>
<li>*I01 – PAI.</li>
<li>*F01 – Subrutinas.</li>
</ul>
<p><img src="/images/2010/08/9.png" alt="Alt Asistente - Especificación de includes" title="Asistente - Especificación de includes"></p>
<p>El último paso no sindicará las acciones que se van a realizar. Pulsaremos sobre finalizar y el asistente creará el
código necesario.</p>
<p><img src="/images/2010/08/10.png" alt="Alt Asistente - Finalizar" title="Asistente - Finalizar"></p>
<p>En las siguientes secciones analizaremos el código para comprenderlo.</p>
<h2 id="c-digo-generado-por-el-asistente-en-el-pbo">Código generado por el asistente en el PBO</h2>
<p>En la pestaña de la lógica de proceso se ha creado el siguiente código para el PBO.</p>
<pre><code>MODULE TC_VAC_CHANGE_TC_ATTR.
MODULE TC_VAC_CHANGE_COL_ATTR.
LOOP AT   IT_TABLECONTROL
     INTO WA_TABLECONTROL
     WITH CONTROL TC_VAC
     CURSOR TC_VAC-CURRENT_LINE.
  MODULE TC_VAC_GET_LINES.
  MODULE TC_VAC_CHANGE_FIELD_ATTR.
ENDLOOP.
</code></pre><p>Ciertas líneas aparecerán comentadas pero en este manual expondremos para que se utilizara cada uno de los módulos.</p>
<p>Dentro del módulo TC_VAC_CHANGE_TC_ATTR de la línea 1 pondríamos el código para cambiar los atributos del Table Control por completo.</p>
<p>Dentro del módulo TC_VAC_CHANGE_COL_ATTR de la línea 2 pondríamos el código para cambiar los atributos de las columnas del Table Control.</p>
<p>Desde la línea 3 hasta la 9 hay un bucle que recorre cada una de las líneas de la tabla interna. Será en este bucle
donde se realizarán las diferentes acciones referentes a modificar el aspecto de cada una de las celdas de la tabla
como por ejemplo permitir o no la modificación de esa celda. Dentro del módulo TC_VAC_CHANGE_FIELD_ATTR será el punto
más idóneo para realizar esas tareas.  En el siguiente trozo de código se puede ver un ejemplo de lo que podemos
realizar.</p>
<pre><code>MODULE TC_VAC_CHANGE_FIELD_ATTR OUTPUT.
  LOOP AT SCREEN.
    IF screen-NAME = &#39;WA_TABLECONTROL-FECHA&#39;.
      IF WA_TABLECONTROL-FECHA &gt; sy-datum.
        screen-INPUT = &#39;1&#39;.
      ENDIF.
    ENDIF.
    MODIFY SCREEN.
  ENDLOOP.
ENDMODULE.
</code></pre><p>En el anterior código, se activan las casillas de la tabla que contengan una fecha mayor a la del día de hoy. En la
línea 2 se realiza un bucle sobre los campos de una fila de la tabla. En la línea 3 se comprueba si el capo actual de
la ventana es el que no s interesa y en la línea 4 se comprueba la condición sobre ese campo. Si la condición se
cumple, en la línea 5 se cambia la propiedad de la ventana que indica si el campo está disponible para operaciones de
entrada y salida. Finalmente en la línea 8 se realiza la modificación de los cambios que se han realizado en la ventana.</p>
<h2 id="c-digo-generado-por-el-asistente-en-el-pai">Código generado por el asistente en el PAI</h2>
<p>En la pestaña de la lógica de proceso se ha creado el siguiente código para el PBO.</p>
<pre><code>LOOP AT IT_TABLECONTROL.
    CHAIN.
      FIELD WA_TABLECONTROL-IDEMP.
      FIELD WA_TABLECONTROL-FECHA.
      FIELD WA_TABLECONTROL-NOMBR.
      FIELD WA_TABLECONTROL-APEL1.
      FIELD WA_TABLECONTROL-APEL2.
      MODULE TC_VAC_MODIFY ON CHAIN-REQUEST.
    ENDCHAIN.
    FIELD WA_TABLECONTROL-MARK
      MODULE TC_VAC_MARK ON REQUEST.
ENDLOOP.
MODULE TC_VAC_USER_COMMAND.
MODULE TC_VAC_CHANGE_TC_ATTR.
MODULE TC_VAC_CHANGE_COL_ATTR.
</code></pre><p>En la linea 8 se hace la llamada al módulo que realizará la modificación en la tabla interna de los cambios que se
hayan realizado en la ventana. En este paso sería importante antes de realizar dicha modificación, comprobar la validez
de los datos introducidos en la Dynpro Como en el siguiente ejemplo:</p>
<pre><code>MODULE TC_VAC_MODIFY INPUT.
 IF WA_TABLECONTROL-FECHA &gt; sy-datum.
   MODIFY IT_TABLECONTROL
     FROM WA_TABLECONTROL
     INDEX TC_VAC-CURRENT_LINE.
 ELSE.
   MESSAGE &#39;Fecha anterior a la actual&#39; TYPE &#39;W&#39;.
 ENDIF.
ENDMODULE.
</code></pre><p>Como vemos si la fecha solicitada es  mayor que la actual (línea 2) se realiza la modificación. Si es anterior se
muestra el mensaje de error. Es importante notar que al estar el módulo dentro de un CHAIN … ENDCHAIN si se produce
un mensaje de error en el módulo se regresa a la Dynpro y se activarán únicamente para modificación los campos
declarados con la clausula FIELD .</p>
<p>En la línea 13 le realiza una llamada al módulo TC_VAC_USER_COMMAND. Este módulo es el encargado de gestionar los
botones propios del Table Control  para insertar, borrar, avanzar o retroceder paginas o filas, marcar o desmarcar
una fila, etc.</p>
<p>Dentro del módulo TC_VAC_USER_COMMAND se llama a la subrutina USER_OK_TC que es la encargada de comprobar cual es el
botón que ha sido pulsado y encaminar la ejecución a la subrutina encargada de la lógica de ese botón. En el siguiente
diagrama se puede ver dicha lógica.</p>
<p><img src="/images/2010/08/11.png" alt="Alt Flujo de la lógica de control para los botones del Table Control" title="Flujo de la lógica de control para los botones del Table Control"></p>
<p>El código estándar funciona para la mayoría de las necesidades, pero si por ejemplo necesitamos que la inserción de
nuevas filas en la tabla ciertos campos se completen por defecto, necesitaremos modificar el código de la subrutina
FCODE_INSERT_ROW.</p>

  </article>
  
</div>

        </div>
      </div>
    </div>
    <footer class="footer">
  <div class="p2 wrap">
    <div class="measure mt1 center">
      <small>
        built with <a href="http://www.metalsmith.io/">metalsmith</a> & theme from <a href="https://github.com/johnotander/pixyll">pixyll</a>
      </small>
    </div>
  </div>
</footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="/js/jquery.easing.js"></script>
    <script src="/js/eu-cookie-law.js"></script>
    <script src="/js/scripts.js"></script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-68223149-1', 'auto');
  ga('send', 'pageview');
</script>
    
<script type="text/javascript">
  
  // Twitter
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script>



     abap ,  asistente ,  dynpro ,  module ,  PAI ,  PBO ,  SAP ,  subrutina ,  table control 

  </body>
</html>
