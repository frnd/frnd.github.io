<!--                                .,,*,..                                -->
<!--                       .#%%%%%%%%%%%%%%%%%%%%%(         .              -->
<!--           #%%%    .#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#   %%%%%%           -->
<!--         %%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%%%%%%%#         -->
<!--       .%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%(        -->
<!--       %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%        -->
<!--       %%%%%%%%%%%%%%/         #%%%%%%%%/       /%%%%%%%%%%%%%         -->
<!--        .*#%%%%%%%#              (%%%#             *%%%%%%%%.          -->
<!--         .%%%%%%%*                 %                 %%%%%%%%          -->
<!--         #%%%%%%(         /*             *            %%%%%%%/         -->
<!--         %%%%%%%         %%.            %%            *%%%%%%#         -->
<!--         %%%%%%%         %%%/          ,%%#,           %%%%%%#         -->
<!--         #%%%%%%         %%%%           %%%%          ,%%%%%%,         -->
<!--          %%%%%%#         %%            *%#           %%%%%%%          -->
<!--          *%%%%%%#                                   #%%%%%%           -->
<!--           .%%%%%%#          %#     .%/(%(          #%%%%%%            -->
<!--             #%%%%           %           %           %%%%/             -->
<!--               %%/            *.        .            /%(               -->
<!--                 (                                   /                 -->
<!--                 %,    /%*                    .#/   ,,                 -->
<!--                  %/       *#%%%%######%%%%#*      (%                  -->
<!--                   %%#                           #%/                   -->
<!--                     #%%%,                   *%%%,                     -->
<!--                        (%%%%%%%#(//((#%%%%%%%,                        -->
<!--                             *#%%%%%%%%#(,                             -->
 <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>PWA con Ionic3 y Workbox en 2 patadas.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/images/favicon.ico">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="alternate" type="application/rss+xml" title="frnd" href="/rss.xml">
    
    <meta name="author" content="Fernando González">
    
    
    <meta name="keywords" content="pwa, ionic3, workbox">
    
    <style>
      .full {
        background: url("/images/madrid-by-night.jpg") no-repeat center center fixed;
        -webkit-background-size: cover;
        -moz-background-size: cover;
        -o-background-size: cover;
        background-size: cover;
      }
      .full body,
      .full .jumbotron {
        background: transparent;
      }
      .full .jumbotron * {
        color: white;
      }
      .full .jumbotron {
        padding-top: 10rem;
        padding-bottom: 5rem;
      }
      .button {
        -moz-appearance: none;
        -webkit-appearance: none;
        -o-appearance: none;
        -ms-appearance: none;
        appearance: none;
        -moz-transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        -webkit-transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        -o-transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        -ms-transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        background-color: #192024;
        border-radius: 6px;
        border: 0;
        color: #fff !important;
        cursor: pointer;
        display: inline-block;
        font-weight: 300;
        text-transform: uppercase;
        letter-spacing: 0.125em;
        font-size: 0.9em;
        height: 2.85em;
        line-height: 2.85em;
        padding: 0 1.75em;
        text-align: center;
        text-decoration: none;
        white-space: nowrap;
        text-indent: 0.25em;
      }
      .button.alt {
        background-color: transparent;
        box-shadow: inset 0 0 0 1px rgba(144, 144, 144, 0.75);
        color: #fff !important;
      }
    </style>
  </head>
  <body>
    <div class="site-wrap ">
      
<header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="/" class="site-title">frnd</a>
      <nav class="site-nav right">
        <a href="/blog">Blog</a><a href="/about">About</a></nav>
      <div class="clearfix"></div>
      
    </div>
  </div>
</header>


      <div class="post p2 p-responsive wrap" role="main">
        <div class="measure">
          
<div class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header mb2">
    <h1 itemprop="headline">PWA con Ionic3 y Workbox en 2 patadas.</h1>
    <span class="post-meta" itemprop="datePublished" content="2018-05-01">May 1, 2018</span>
    <span class="post-meta small">por</span> <span class="post-meta small" itemprop="author">Fernando González</span><br>
    <span class="post-meta small">
    <a href="/tags/pwa" title="pwa"><span itemprop="keywords">pwa</span></a>, <a href="/tags/ionic3" title="ionic3"><span itemprop="keywords">ionic3</span></a>, <a href="/tags/workbox" title="workbox"><span itemprop="keywords">workbox</span></a>
    </span>
  </header>
  <article class="post-content py2" itemprop="text">
  
  <h6 itemprop="alternativeHeadline">En 2 sencillos pasos vamos a crear una aplicación web progresiva partiendo de un proyecto en ionic 3. Usaremos Workbox ya que ofrece muchas posibilidades.</h6>
  
  <p></p>
<!-- more -->
<p>Para este artículo vamos a partir de un proyecto de ionic 3 ya creado. Puedes crearte uno facilmente con ionic-cli:</p>
<pre><code class="hljs">ionic <span class="hljs-built_in">start</span> ionic3-pwa-workbox blank</code></pre>

<h2 id="primera-patada-activar-el-service-worker">Primera patada: Activar el service worker</h2>
<p>Para este paso vamos al fichero <code>./src/index.html</code> y descomentamos el siguiente código:</p>
<pre><code class="hljs">&lt;script&gt;
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'serviceWorker'</span> <span class="hljs-keyword">in</span> navigator) {
      navigator.serviceWorker.register(<span class="hljs-string">'service-worker.js'</span>)
        .<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'service worker installed'</span>))
        .<span class="hljs-keyword">catch</span>(err =&gt; <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Error'</span>, err));
    }
&lt;/script&gt;</code></pre>

<p>Desde este momento ya tenemos el service worker activo con lo que ciertas rutas estarán cacheadas. Podemos verlo si lanzamos <code>ìonic serve</code> y vamos a la consola:</p>
<p><img src="/images/2018/05/pwa-ionic3-workbox-1.png" alt="service worker installed" title="service worker installed"></p>
<h2 id="segunda-patada-usar-workbox">Segunda patada: usar Workbox</h2>
<p>primero vamos a instalar workbox con npm:</p>
<pre><code class="hljs">npm <span class="hljs-tag">i</span> workbox-sw --save</code></pre>

<p>Y ahora vamos a indicar a ionic que nos copie este fichero al hacer el build extendiendo la configuración por defecto. Crearemos un fichero al que lamaremos <code>/config/copy.config.js</code> con el siguiente contenido:</p>
<pre><code class="hljs"><span class="xml">module.exports = </span><span class="hljs-expression">{
  <span class="hljs-variable">copyWorkboxSw</span>: {
    <span class="hljs-variable">src</span>: ['<span class="hljs-end-block">/node</span>_<span class="hljs-variable">modules</span><span class="hljs-end-block">/workbox-sw</span><span class="hljs-end-block">/build</span><span class="hljs-end-block">/workbox-sw.js</span>'],
    <span class="hljs-variable">dest</span>: ''
  }</span><span class="xml">
}</span></code></pre>

<p>Indicaremos en <code>package.json</code> el siguiente codigo para indicarle a ionic que tambien use la configuración que hemos creado:</p>
<pre><code class="hljs"><span class="hljs-string">"config"</span>: {
    <span class="hljs-string">"ionic_copy"</span>: <span class="hljs-string">"./config/copy.config.js"</span>
  }</code></pre>

<p>Y modificaremos el service worker creado por ionic en nuestro proyecto por uno usando Workbox:</p>
<pre><code class="hljs"><span class="hljs-pi">'use strict'</span>;
importScripts(<span class="hljs-string">'./build/workbox-sw.js'</span>);

<span class="hljs-comment">/*
This is our code to cache static files.
*/</span>
self.workbox.precaching.precacheAndRoute([
    <span class="hljs-string">'./build/main.js'</span>,
    <span class="hljs-string">'./build/vendor.js'</span>,
    <span class="hljs-string">'./build/main.css'</span>,
    <span class="hljs-string">'./build/polyfills.js'</span>,
    <span class="hljs-string">'index.html'</span>,
    <span class="hljs-string">'manifest.json'</span>
    ]
);</code></pre>

<h2 id="para-terminar-patapum-pariba-y-test-con-lighthouse-">Para terminar: patapum pariba y test con Lighthouse.</h2>
<p>Para este artículo voy a usar gh-pages pero cualquier otro hosting que ofrezcan https sería valido.</p>
<p>Mediante los siguientes comandos construiremos la aplicación para subirla a producción.</p>
<pre><code class="hljs">ionic cordova <span class="hljs-built_in">platform</span> <span class="hljs-built_in">add</span> browser
ionic cordova build browser <span class="hljs-comment">--prod</span></code></pre>

<p>Ahora tendremos nuestra aplicación en  <code>./platforms/browser/www/</code> asi que subiremos este directorio a nuestra rama gh-pages (recuerda usar tu nombre de usuario y tu repositorio en github):</p>
<pre><code class="hljs">cd platforms<span class="hljs-regexp">/browser/</span>www/
git init
git remote add origin <span class="hljs-string">https:</span><span class="hljs-comment">//github.com/frnd/ionic3-pwa-workbox.git</span>
git add --all
git commit -m <span class="hljs-string">"production build"</span>
git push origin <span class="hljs-string">master:</span>gh-pages -f</code></pre>

<p>Nuestra PWA está disponible en (<a href="https://frnd.github.io/ionic3-pwa-workbox/)[https://frnd.github.io/ionic3-pwa-workbox/">https://frnd.github.io/ionic3-pwa-workbox/)[https://frnd.github.io/ionic3-pwa-workbox/</a>]. En la siguiente captura puedes ver los resultados que da Lighthouse.</p>
<p><img src="/images/2018/05/pwa-ionic3-workbox-2.png" alt="Resultados Lighthouse" title="Resultados Lighthouse"></p>
<h2 id="codigo-fuente-y-enlaces-">Codigo fuente y enlaces.</h2>
<p>Puedes ver el codigo fuente de este royecto en (github)[<a href="https://github.com/frnd/ionic3-pwa-workbox">https://github.com/frnd/ionic3-pwa-workbox</a>] y acceder al ejemplo (ionic3-pwa-workbox)[<a href="https://frnd.github.io/ionic3-pwa-workbox/">https://frnd.github.io/ionic3-pwa-workbox/</a>]. Mas información de interés:</p>
<ul>
<li>(ionic)[<a href="https://ionicframework.com/">https://ionicframework.com/</a>]</li>
<li>(Progressive Web Apps)[<a href="https://developers.google.com/web/progressive-web-apps/">https://developers.google.com/web/progressive-web-apps/</a>]</li>
<li>(Workbox)[<a href="https://developers.google.com/web/tools/workbox/#get-started">https://developers.google.com/web/tools/workbox/#get-started</a>]</li>
</ul>
<p>Para problemas o comentarios, puedes crear un tema en el github del proyecto <a href="https://github.com/frnd/ionic3-pwa-workbox/issues/new">https://github.com/frnd/ionic3-pwa-workbox/issues/new</a></p>

  </article>
  
</div>

        </div>
      </div>
    </div>
    <footer class="footer">
  <div class="p2 wrap">
    <div class="measure mt1 center">
      <small>
        built with <a href="http://www.metalsmith.io/">metalsmith</a> & theme from <a href="https://github.com/johnotander/pixyll">pixyll</a>
      </small>
    </div>
  </div>
</footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="/js/jquery.easing.js"></script>
    <script src="/js/eu-cookie-law.js"></script>
    <script src="/js/scripts.js"></script>
  </body>
</html>
